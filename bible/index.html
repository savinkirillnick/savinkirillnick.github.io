<!DOCTYPE html>
<html lang="ru">
<head>
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–≤–∏–∫–æ–Ω -->
    <link rel="icon" href="https://savinkirillnick.github.io/bible/favicon.png">

    <!-- Icons for different sizes on iOS devices -->
    <link rel="apple-touch-icon" sizes="57x57" href="https://savinkirillnick.github.io/bible/icons/icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="https://savinkirillnick.github.io/bible/icons/icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://savinkirillnick.github.io/bible/icons/icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="https://savinkirillnick.github.io/bible/icons/icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://savinkirillnick.github.io/bible/icons/icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="https://savinkirillnick.github.io/bible/icons/icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://savinkirillnick.github.io/bible/icons/icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://savinkirillnick.github.io/bible/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://savinkirillnick.github.io/bible/icons/icon-180x180.png">

    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è iOS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π -->
    <meta name="apple-mobile-web-app-capable" content="yes"> <!-- –í–∫–ª—é—á–∞–µ—Ç –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"> <!-- –°—Ç–∞—Ç—É—Å–±–∞—Ä –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —á–µ—Ä–Ω—ã–π -->
    <meta name="theme-color" content="#ffffff"> <!-- –¶–≤–µ—Ç —Ñ–æ–Ω–∞ –æ–∫–Ω–∞ –±—Ä–∞—É–∑–µ—Ä–∞ -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <meta name="description" content="–ë–∏–±–ª–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º.">
    <meta name="keywords" content="–±–∏–±–ª–∏—è, javascript">
    <meta name="author" content="Kirill Savin">
    
    <meta property="og:title" content="–ë–∏–±–ª–∏—è." />
    <meta property="og:description" content="–ë–∏–±–ª–∏—è." />
    <meta property="og:image" content="https://savinkirillnick.github.io/bible/logo.jpg" />
    <meta property="og:url" content="https://savinkirillnick.github.io/bible/" />
    <meta property="og:type" content="website" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="–ë–∏–±–ª–∏—è." />
    <meta name="twitter:description" content="–ë–∏–±–ª–∏—è." />
    <meta name="twitter:image" content="https://savinkirillnick.github.io/bible/logo.jpg" />
    <title>–ë–∏–±–ª–∏—è/title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #fafafa;
            color: #333;
            text-align: center;
            font-size: 12pt;
        }
        p {
            text-indent: 30px;
            padding: 0 5px;
            line-height: 1.4;
            margin: 0;
        }
        i {
            color: #666;
        }
        .screen {
            position: relative;
            max-width: 600px;
            left: 50%;
            transform: translate(-50%, 0%);
        }
        .num {
            font-size: 0.6em;
            color: #666;
            vertical-align: text-top;
        }
        .content {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            text-align: left;
        }
        .controls button {
            margin: 5px;
            padding: min(20px, 3vw);
            background: transparent;
            border: 0;
            font-size: min(20pt, 5vw);
            cursor: pointer;
            transition: all 0.3s ease-in-out;
        }
        .menu {
            display: none;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        .chapters {
            display: none;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            min-height: 50px;
            position: absolute;
            top: calc(6vw + 10px + min(20pt, 5vw));
            left: 50%;
            transform: translate(-50%, 0%);
        }
        .menu-item {
            text-align: left;
            padding: 5px;
            margin: 0;
        }
        .chapters-item {
            text-align: center;
            padding: 5px;
            margin: 0;
        }
        .link {
            color: #06d;
            cursor: pointer;
        }
        .gray {
            color: #666;
        }
        @media (orientation: landscape) {
            .chapters {
                grid-template-columns: repeat(10, 1fr);
            }
        }
        @media (orientation: portrait) {
            .chapters {
                grid-template-columns: repeat(5, 1fr);
            }
        }
    </style>
    <script src="main.js"></script>
    <script src="verseofday.js"></script>
    <script src="holidays.js"></script>
</head>
<body>

<div class="screen">
    <div class="controls top-controls">
        <button onclick="previousChapter()">‚óÄÔ∏è</button>
        <button onclick="showMainPage()">üè†</button>
        <button onclick="showBookMenu()">üìï</button>
        <button onclick="showChapterMenu()">üìÉ</button>
        <!-- <button onclick="showTranslateMenu()">‚öôÔ∏è</button> -->
        <button onclick="nextChapter()">‚ñ∂Ô∏è</button>
    </div>
    <div class="content" id="content"></div>
    <div class="content" id="last-book"></div>
    <div class="content" id="calendar"></div>
    <div class="content" id="verse-of-day"></div>
    <div class="content menu" id="books-menu"></div>
    <div class="content chapters" id="chapters-menu"></div>
    <div class="controls bottom-controls">
        <button onclick="previousChapter(); window.scrollTo(0, 0);">‚óÄÔ∏è</button>
        <button onclick="window.scrollTo(0, 0);">‚¨ÜÔ∏è</button>
        <button onclick="nextChapter(); window.scrollTo(0, 0);">‚ñ∂Ô∏è</button>
    </div>
    <div class="content">
    <center>–ë–∏–±–ª–∏—è 2025<br>–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –Ω–∞–ø–∏—à–∏—Ç–µ –º–Ω–µ –≤ —Ç–µ–ª–µ–≥—Ä–∞–º <a class="link" href="https://t.me/savinkirillnick">@savinkirillnick</a></center>
    </div>
</div>
<script type="text/javascript">

//–°–ø–∏—Å–æ–∫ –∫–Ω–∏–≥
const lib = new Lib();

function showMainPage() {
  document.getElementById('content').style.display = "none";
  document.getElementById('books-menu').style.display = "none";
  document.getElementById('chapters-menu').style.display = "none";
  document.getElementById('last-book').style.display = "block";
  document.getElementById('calendar').style.display = "block";
  document.getElementById('verse-of-day').style.display = "block";
}

function showBookMenu() {
  document.getElementById('last-book').style.display = "none";
  document.getElementById('calendar').style.display = "none";
  document.getElementById('verse-of-day').style.display = "none";
  document.getElementById('chapters-menu').style.display = "none";
  if (document.getElementById('content').style.display === "none") {
    document.getElementById('content').style.display = "block";
    document.getElementById('books-menu').style.display = "none";
  } else {
    document.getElementById('content').style.display = "none";
    document.getElementById('books-menu').style.display = "grid";
  }
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–µ–Ω—é
function generateBooksMenu(lib) {
  let html = '';
  
  lib.forEach(section => {
    html += '<div>';
    
    // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–∞–∑–¥–µ–ª–∞
    html += `<div class="menu-item"><b>${section.name}</b></div>`;
    
    // –ì—Ä—É–ø–ø—ã –∫–Ω–∏–≥
    section.groups.forEach(group => {
      // –ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã
      html += `<div class="menu-item gray">${group.name}</div>`;
      
      // –ö–Ω–∏–≥–∏ –≤ –≥—Ä—É–ø–ø–µ
      group.books.forEach(book => {
        html += `<div class="menu-item link" onclick="changeBook('${book.link}'); window.scrollTo(0, 0);">${book.title}</div>`;
      });
    });
    
    html += '</div>';
  });
  
  return html;
}

document.getElementById('books-menu').innerHTML = generateBooksMenu(lib.lib);

async function showChapterMenu() {
  document.getElementById('last-book').style.display = "none";
  document.getElementById('calendar').style.display = "none";
  document.getElementById('verse-of-day').style.display = "none";
  try {
    document.getElementById('content').style.display = "block";
    document.getElementById('books-menu').style.display = "none";
    if (document.getElementById('chapters-menu').style.display === "none") {
        document.getElementById('chapters-menu').style.display = "grid";
    } else {
        document.getElementById('chapters-menu').style.display = "none";
    }
    const chapters = await bible.getChaptersList();
    document.getElementById('chapters-menu').innerHTML = generateChaptersMenu(chapters);

  } catch (error) {
    console.error('–û—à–∏–±–∫–∞:', error);
  }
}

function generateChaptersMenu(chapters) {
  let html = '';
  chapters.forEach(item => {
    html += `<div class="chapters-item link" onclick="changeChapter('${item.index}'); window.scrollTo(0, 0);">${item.number}</div>`;
  });
  return html;
}


function formatDateToNormal(dateStr) {
  const options = { year: 'numeric', month: 'long', day: 'numeric' };
  const date = new Date(dateStr);
  return date.toLocaleDateString('ru-RU', options);
}
    
function showLastBook(info) {
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –∫–Ω–∏–≥—É –Ω–∞ –≥–ª–∞–≤–Ω–æ–π
  const last_book = bible.lastSeen();
  let text = "<h3>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h3>";
  if (last_book.book === 'byt' && last_book.chapterIndex === 0) {
    text += `<p>–ù–∞—á–Ω–∏—Ç–µ —á—Ç–µ–Ω–∏–µ –±–∏–±–ª–∏–∏ —Å –∫–Ω–∏–≥–∏ ¬´–ë—ã—Ç–∏–µ¬ª.</p>`;
    text += `<span class="link" onclick="changeBook('${last_book.book}'); changeChapter('${last_book.chapterIndex}'); window.scrollTo(0, 0);">–ù–∞—á–∞—Ç—å —á–∏—Ç–∞—Ç—å</span>`;
  } else {

    let chapterNumber = info.chapterNumber;
    if (info.chapterNumber === '0') {
      chapterNumber = '–ü—Ä–µ–¥–∏—Å–ª–æ–≤–∏–µ';
    } else {
      chapterNumber = `–≥–ª–∞–≤–∞ ${chapterNumber}`;
    }
    text += `<p>–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –≤—ã —á–∏—Ç–∞–ª–∏ ¬´${lib.short[last_book.book].full}¬ª, ${chapterNumber}.</p>`;
    text += `<span class="link" onclick="changeBook('${last_book.book}'); changeChapter('${last_book.chapterIndex}'); window.scrollTo(0, 0);">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</span>`;
  }
  return text;
}

function showVerseOfTheDay() {
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∏—Ö –¥–Ω—è
  let text = "<h3>–°—Ç–∏—Ö –¥–Ω—è</h3>";
    
  // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–≥–æ —á–∏—Å–ª–∞ –≥–æ–¥–∞
  const today = new Date();
  const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
    
  // –ò–Ω–¥–µ–∫—Å –≤—ã–±–∏—Ä–∞–µ–º–æ–≥–æ —Å—Ç–∏—Ö–∞
  const index = dayOfYear % verseofday.length;

  text += `<p>${verseofday[index].verse}</p>`;
  const b = verseofday[index].code.split(":");
  text += `<p><span class="gray">${verseofday[index].book}:${b[1]}:${b[2]}</span></p>`;
  
  return text;
}

function churchCalendar() {
  // –§—É–Ω–∫—Ü–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è

  const today = new Date(); // –°–µ–≥–æ–¥–Ω—è—à–Ω—è—è –¥–∞—Ç–∞
  const thisYear = today.getFullYear();
  const calendarData = getChurchCalendar(thisYear);
  const nearestEvents = findNearestHolidayAndFast(today, calendarData);
  let text = "<h3>–¶–µ—Ä–∫–æ–≤–Ω—ã–µ –ø—Ä–∞–∑–¥–Ω–∏–∫–∏</h3>";
  console.log(`–°–µ–≥–æ–¥–Ω—è: ${formatDate(today)}`);

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –µ—Å—Ç—å –ª–∏ —Å–µ–≥–æ–¥–Ω—è –ø—Ä–∞–∑–¥–Ω–∏–∫
  const todaysHoliday = calendarData.holidays.find(holiday => formatDate(new Date(holiday.date)) === formatDate(today));
  if (todaysHoliday) {
    text += `<p>–°–µ–≥–æ–¥–Ω—è –ø—Ä–∞–∑–¥–Ω–∏–∫: ${todaysHoliday.name}</p>`;
  }

  // –¢–µ–∫—É—â–∏–π –ø–æ—Å—Ç
  if (nearestEvents.currentFast) {
    text += `<p>–°–µ–π—á–∞—Å –∏–¥–µ—Ç –ø–æ—Å—Ç: ${nearestEvents.currentFast.name}, –ø—Ä–æ–¥–ª–∏—Ç—Å—è –¥–æ ${formatDateToNormal(nearestEvents.currentFast.endDate)}</p>`;
  }

  // –ë–ª–∏–∂–∞–π—à–∏–π –≥—Ä—è–¥—É—â–∏–π –ø—Ä–∞–∑–¥–Ω–∏–∫
  if (nearestEvents.nextHoliday) {
    text += `<p>–°–ª–µ–¥—É—é—â–∏–π –ø—Ä–∞–∑–¥–Ω–∏–∫: ${nearestEvents.nextHoliday.name}, —Å–æ—Å—Ç–æ–∏—Ç—Å—è ${formatDateToNormal(nearestEvents.nextHoliday.date)}</p>`;
  } else {
    text += "<p>–ë–æ–ª—å—à–µ –ø—Ä–∞–∑–¥–Ω–∏–∫—É –≤ —ç—Ç–æ–º –≥–æ–¥—É –Ω–µ –æ–∂–∏–¥–∞–µ—Ç—Å—è.</p>";
  }

  return text;
}

// –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–Ω–∏–≥–∏
const bible = new Book();

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å async/await
async function loadChapter() {
  try {
    const text = await bible.showText();
    document.getElementById('content').innerHTML = text;
    
    // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–Ω–∏–≥–µ
    const info = bible.getBookInfo();
    document.getElementById('last-book').innerHTML = showLastBook(info);
    console.log('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–Ω–∏–≥–µ:', info);
    
    // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –≥–ª–∞–≤
    const chapters = await bible.getChaptersList();
    document.getElementById('chapters-menu').innerHTML = generateChaptersMenu(chapters);
    console.log('–î–æ—Å—Ç—É–ø–Ω—ã–µ –≥–ª–∞–≤—ã:', chapters);

    document.getElementById('verse-of-day').innerHTML = showVerseOfTheDay();
    document.getElementById('calendar').innerHTML = churchCalendar();
    
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞:', error);
  }
}

// –°–º–µ–Ω–∞ –ø–µ—Ä–µ–≤–æ–¥–∞
async function changeTranslation(newTranslation) {
  const text = await bible.showText(newTranslation, bible.book, bible.chapter);
  document.getElementById('content').innerHTML = text;
}

// –°–º–µ–Ω–∞ –∫–Ω–∏–≥–∏
async function changeBook(newBook) {
    document.getElementById('content').style.display = "block";
    document.getElementById('books-menu').style.display = "none";
  const text = await bible.showText(bible.translate, newBook, 0);
  document.getElementById('content').innerHTML = text;
}

// –°–º–µ–Ω–∞ –≥–ª–∞–≤—ã
async function changeChapter(newChapter) {
  document.getElementById('chapters-menu').style.display = "none";
  const text = await bible.showText(bible.translate, bible.book, newChapter);
  document.getElementById('content').innerHTML = text;
}

// –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≥–ª–∞–≤–∞–º
async function nextChapter() {
  const text = await bible.nextChapter();
  if (text) {
    document.getElementById('content').innerHTML = text;
  }
}

async function previousChapter() {
  const text = await bible.previousChapter();
  if (text) {
    document.getElementById('content').innerHTML = text;
  }
}

function mark(book, chapter, verse, item) {
  bible.mark(book, chapter, verse, item);
}

loadChapter();
showMainPage();    
</script>
</body>
</html>
